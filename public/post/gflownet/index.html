<!DOCTYPE html><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.4.0 for Hugo" />
  

  
  









  




  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
    <meta name="google-site-verification" content="google-site-verification=oJUt4qEgz1nbEKcvDXzsR0LNbHNPGcPECa2xegOaWp8" />
  
  
  
  
    
    
    
  
  

  

  
  
  
    
  
  <meta name="description" content="A brief introduction to generative flow networks" />

  
  <link rel="alternate" hreflang="en-us" href="https://andleb.netlify.app/post/gflownet/" />

  
  
  
    <meta name="theme-color" content="#1565c0" />
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.f1ecf783c14edc00c9320c205831ad8e.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha512-W0xM4mr6dEP9nREo7Z9z+9X70wytKvMGeDsj7ps2+xg5QPrEBXC8tAW1IFnzjR6eoJ90JmCnFzerQJTLzIEHjA==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/monokai-sublime.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/monokai-sublime.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
      
    

    
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css" integrity="" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.cd9e9a3a9af953d5551c8bdbe43c9303.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-228705789-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-228705789-1', {});
  gtag('set', {'cookie_flags': 'SameSite=None;Secure'});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  

  

  




  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://andleb.netlify.app/post/gflownet/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
    <meta property="twitter:site" content="@anleb1" />
    <meta property="twitter:creator" content="@anleb1" />
  
  <meta property="og:site_name" content="Andrej&#39;s thoughts" />
  <meta property="og:url" content="https://andleb.netlify.app/post/gflownet/" />
  <meta property="og:title" content="Generative Flow Networks | Andrej&#39;s thoughts" />
  <meta property="og:description" content="A brief introduction to generative flow networks" /><meta property="og:image" content="https://andleb.netlify.app/post/gflownet/featured.png" />
    <meta property="twitter:image" content="https://andleb.netlify.app/post/gflownet/featured.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2023-10-20T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2023-10-20T21:36:00-07:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://andleb.netlify.app/post/gflownet/"
  },
  "headline": "Generative Flow Networks",
  
  "image": [
    "https://andleb.netlify.app/post/gflownet/featured.png"
  ],
  
  "datePublished": "2023-10-20T00:00:00Z",
  "dateModified": "2023-10-20T21:36:00-07:00",
  
  "publisher": {
    "@type": "Organization",
    "name": "Andrej's thoughts",
    "logo": {
      "@type": "ImageObject",
      "url": "https://andleb.netlify.app/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "A brief introduction to generative flow networks"
}
</script>

  

  

  

  





  <title>Generative Flow Networks | Andrej&#39;s thoughts</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="383f603db33a51a28736481021724125" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.8f76bdc9e086322ed5147724ebba3d06.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    












<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">Andrej&#39;s thoughts</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">Andrej&#39;s thoughts</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/about"><span>About</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link  active" href="/post"><span>Posts</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/publication"><span>Publications</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/project"><span>Projects</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/courses/"><span>Courses</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
            
            <li class="nav-item d-none d-lg-inline-flex">
              <a class="nav-link" href="/"  aria-label="">
                <i class="fas fa-" aria-hidden="true"></i>
              </a>
            </li>
          
        

        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        <li class="nav-item dropdown theme-dropdown">
          <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
            <i class="fas fa-moon" aria-hidden="true"></i>
          </a>
          <div class="dropdown-menu">
            <a href="#" class="dropdown-item js-set-theme-light">
              <span>Light</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-dark">
              <span>Dark</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-auto">
              <span>Automatic</span>
            </a>
          </div>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>Generative Flow Networks</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    Oct 20, 2023
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    7 min read
  </span>
  

  
  
  
  
  
  

  
  

</div>

    





  
</div>



  <div class="article-container">

    <div class="article-style">
      <!-- LaTeX preamble -->
<pre><code class="language-{=tex}">\newtheorem{theorem}{Theorem}

\newcommand{\E}{{\mathbb E}}
\newcommand{\Var}{\mathrm{Var}}
\newcommand{\se}{{\mathcal{E}}}
\newcommand{\R}{{\mathbb R}}
\renewcommand{\P}{{\mathbb P}}
\newcommand{\ac}{{\mathcal{A}}}
\newcommand{\A}{{\mathcal{A}}}
\newcommand{\B}{{\mathcal{B}}}
\newcommand{\T}{{\mathcal{T}}}
\newcommand{\Z}{{\mathcal{Z}}}
\newcommand{\K}{{\mathcal{K}}}
\newcommand{\lc}{{\mathcal{L}}}
\newcommand{\Ps}{{\mathcal{P}}}
\newcommand{\pa}{{\mathring{p}}}
\newcommand{\F}{{\cal F}}
\newcommand{\samp}{{\mathcal{X}}}
\newcommand{\X}{{\mathcal{X}}}
\newcommand{\hi}{{\hat{\Phi}}}
\newcommand{\indep}{\perp \!\!\! \perp}
\def\qt#1{\\qquad\\text{#1}}
\def\argmin{\mathop{\rm argmin}}
\def\argmax{\mathop{\rm argmax}}
</code></pre>
<!-- <details class="toc-inpage d-print-none  " open>
  <summary class="font-weight-bold">Table of Contents</summary>
  <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#mathematical-preliminaries">Mathematical preliminaries</a></li>
    <li><a href="#general-structure">General structure</a>
      <ul>
        <li><a href="#forward-diffusion">Forward diffusion</a></li>
        <li><a href="#reverse-diffusion">Reverse diffusion</a></li>
      </ul>
    </li>
    <li><a href="#training">Training</a>
      <ul>
        <li><a href="#variance-schedule">Variance schedule</a></li>
        <li><a href="#estimating-p">Estimating $p$</a></li>
        <li><a href="#architecture">Architecture</a></li>
      </ul>
    </li>
    <li><a href="#how-does-it-work-in-practice">How does it work in practice?</a>
      <ul>
        <li><a href="#example---recovery">Example - recovery</a></li>
        <li><a href="#example---generation">Example - generation</a></li>
        <li><a href="#imagen--dall-e-2">Imagen &amp; DALL-E 2</a></li>
      </ul>
    </li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
</details>
 -->
<!-- \tableofcontents -->
<h2 id="introduction">Introduction</h2>
<p>Citation example @bengio_gflownet_2023</p>
<p>123456</p>
<h2 id="mathematical-preliminaries">Mathematical preliminaries</h2>
<h2 id="general-structure">General structure</h2>
<p><em>An overview of generative models</em>
(















<figure  id="figure-overview-of-generative-models">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="&lt;a href=&#34;https://lilianweng.github.io/posts/2021-07-11-diffusion-models/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;source&lt;/a&gt;)" srcset="
               /post/gflownet/generative-overview_hucb6f640be08c90d6178259e0eccf4c36_525595_7adb589f84d45e2c76d1da559a4d821d.webp 400w,
               /post/gflownet/generative-overview_hucb6f640be08c90d6178259e0eccf4c36_525595_20877785b17e0fc370f0ef92db4d1aa3.webp 760w,
               /post/gflownet/generative-overview_hucb6f640be08c90d6178259e0eccf4c36_525595_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/gflownet/generative-overview_hucb6f640be08c90d6178259e0eccf4c36_525595_7adb589f84d45e2c76d1da559a4d821d.webp"
               width="760"
               height="526"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Overview of Generative models
    </figcaption></figure>
{width=&ldquo;70%&quot;}</p>
<p>Diffusion models are composed of two separate processes, <strong>the forward</strong> and <strong>the backward</strong>.</p>
<h3 id="forward-diffusion">Forward diffusion</h3>
<p>In general - a diffusion process can be characterized by a <em>Markov diffusion kernel</em> given a final state $\pi(x)$:</p>
<pre><code class="language-{=tex}">\begin{equation}
    q(x_t | x_{t-1}) = T_\pi(x_t | x_{t-1}; \beta_t)
\end{equation}
</code></pre>
<p>Since it&rsquo;s a length-one Markov process, we have for the full joint: \begin{equation}
q(x_{t=0:T} ) = q(x_0) \prod_{i=1}^T q(x_i | x_{i-1})
\end{equation}</p>
<p>Usually, we use a Gaussian diffusion, for which the posterior is closed form (c.f. the 1-step update in <em>Kalman
filtering</em>):</p>
<pre><code class="language-{=tex}">\begin{equation}
    q(x_t | x_{t-1}) = \mathcal{N}(\sqrt{1 - \beta_t}x_{t-1}, \beta_t \mathbf{I})
\end{equation}
</code></pre>
<p>$\beta_i$s are called the <strong>variance schedule</strong>, with usually $\beta_1 &lt; \beta_2 &lt; &hellip; &lt; \beta_T$.</p>
<p>Moreover, due to the property of the Gaussian distribution:</p>
<p>$$\alpha_t := 1 - \beta_t$$</p>
<p>$$\bar{\alpha}<em>t := \prod</em>{s=1}^t \alpha_t$$</p>
<pre><code class="language-{=tex}">\begin{equation}
q(x_t | x_0) = \mathcal{N}(\sqrt{\bar{\alpha_t}}~x_0, (1 - \alpha_t) \mathbf{I}),
\end{equation}
</code></pre>
<p>meaning any state in the forward process can be expressed knowing <em>just the initial one</em> and the <em>variance schedule</em>. In
general, the theoretical underpinning of <em>Langevin dynamics</em> guarantees any smooth distribution can be corrupted into
Gaussian noise, meaning the initial distribution can be almost arbitrarily complex, giving the model its expressive
power.</p>
<h3 id="reverse-diffusion">Reverse diffusion</h3>
<p>The reverse process is characterized by a new transition probability $p(x)$. Its starting point is the stationary
distribution at the final time $T$:</p>
<pre><code class="language-{=tex}">\begin{equation}
    \pi(x_T) := p(x_T)
\end{equation}
</code></pre>
<p>Like before:</p>
<pre><code class="language-{=tex}">\begin{equation}
    p(x_{t=T:0}) = p(x_T) \prod_{i=T-1}^1 p(x_i+1 | x_{i})
\end{equation}
</code></pre>
<p>For Gaussian (and binomial), the joint is still in the same family; however, there is no closed-form for the parameters
$\mu$ and $\Sigma$. These need to be estimated, in this case via neural networks.</p>
<p>A natural training target is the likelihood of the original data $p(x_0)$ as given by the learned reverse process'
distribution, obtained by marginalizing the full joint: \begin{equation}
p(x_0) = \int_{\mathcal{X}} p(x_{t=T:0}) ~ dx_1 &hellip;. dx_T
\end{equation}</p>
<p>This is computationally intractable! A trick is to use annealed importance sampling - comparing the relative probability
of the backward - $p$ - and the forward trajectories $q$, where the latter are known in closed form:</p>
<pre><code class="language-{=tex}">\begin{equation}
    p(x_0) = \int_{\mathcal{X}} q(x_{t=1:T}) ~p(x_T)~ \prod_{t=1}^T \frac{p(x_{t-1}|x_t)}{q(x_{t}|x_{t-1})} ~ dx_1 .... dx_T
\end{equation}
</code></pre>
<p>In the limit of very small $\beta$, both directions become the same.</p>
<h2 id="training">Training</h2>
<p>We maximize the <strong>expected</strong> log likelihood of the original data $p(x_0)$ under the original true distribution $q(x_0)$:</p>
<pre><code class="language-{=tex}">\begin{align}
    &amp; L(p, q) = \mathbb{E}_{q(x_0)} [p(x_0)] = \int_{\mathcal{X}} q(x_0) ~ \log p(x_T)~ dx_0\\
    &amp; = -~\mathbb{E}_{q} \left[ \underbrace{D( q(x_T | x_0) || p(x_T))}_{L_T} + \underbrace{\sum_{t=2}^T D( q(x_{t-1} | x_t, x_0) || p(x_{t-1} || x_t))}_{L_{t-1}} - \underbrace{\log p(x_0 | x+1)}_{L_0}   \right]
\end{align}
</code></pre>
<p>It can be <em>lower bounded</em> by a closed-form expression:</p>
<pre><code class="language-{=tex}">\begin{align}
    L \geq K = - \sum_{t=2}^T \int q(x_0, x_t) ~ D(q(x_{t-1}|x_{t}, x_{0}) ~||~ p(x_{t-1}|x_{t}))~dx_0,~dx_t\\ 
    + H_q(X_T|X_0) - H_q(X_1|X_0) - H_p(X_T),&amp;
\end{align}
</code></pre>
<p>where $D$ is the K-L divergence and H denotes the (conditional) entropies. Hence maximizing the latter maximizes the
former.</p>
<p>Additionally, conditioning the forward process posteriors on $x_0$ gives us the closed-forms</p>
<pre><code class="language-{=tex}">\begin{equation}
q(x_{t-1}|x_{t}, x_{0}) = \mathcal{N}(\tilde{\mu}_t, \tilde{\beta}_t \mathbf{I})
\end{equation}
</code></pre>
<p>$$\tilde{\mu}<em>t := \frac{\sqrt{\bar{\alpha}</em>{t-1}} \beta_t}{1 - \bar{\alpha}<em>t}~x_0 + \frac{\sqrt{\bar{\alpha}</em>{t}} (1 - \bar{\alpha}_{t})}{1 - \bar{\alpha}_t}~x_t$$</p>
<p>$$\tilde{\beta}<em>t := \frac{1 - \bar{\alpha}</em>{t-1}}{1 - \bar{\alpha}_t} \beta_t$$</p>
<p>The goal of training is therefore to <strong>estimate the reverse Markov transition densities</strong> $p(x_{t-1}|x_t)$:
$$\hat{p}(x_{t-1}|x_t) = \underset{p}{\operatorname{argmax}} K$$</p>
<p>As mentioned, in the case of the Gaussian and binomial, the reverse process stays in the same family, therefore the task
amounts to estimating the parameters.</p>
<h3 id="variance-schedule">Variance schedule</h3>
<p>Since $\beta_t$ is a free parameter, it can be learned simultaneously with the whole $K$ optimization procedure,
freezing the other variables and optimizing on $\beta$. Alternatively, the first paper also treated a sequence as a
hyperparameter and used a simply linearly increasing $\beta$. This is also the approach of <em>Ho et al.</em></p>
<h3 id="estimating-p">Estimating $p$</h3>
<p>Our goal is to learn the following:</p>
<p>$$
p(x_{t-1} | x_t) = \mathcal{N}(\mu(x_t, t), \Sigma(x_t, t)), ~~ t \in [T, 0]
$$ which corresponds to estimating $\mu(x_t, t), \Sigma(x_t, t)$.</p>
<p>For the variance, it is simply set to be isotropic with the diagonal entries either <strong>fixed</strong> at a constant (either
$\beta_t$ or $\tilde{\beta}_t$) or <strong>learned</strong>. The latter proved to be unstable in Ho et al., but has since been
successfully implemented.</p>
<p>The mean is, of course, learned in all implementations and proceeds as follows: by inspecting the $L_{t-1}$ term in the
likelihood in [Training], the minimizing mean can be expressed by the reparametrization:
$$x_t = \sqrt{\bar{\alpha}_t}~x_0 + \sqrt{1 - \bar{\alpha}_t}~\epsilon $$ $$\epsilon \sim \mathcal{N}(0, \mathbf{I})$$</p>
<pre><code class="language-{=tex}">\begin{equation}
\mu(x_t, t) = \frac{1}{\sqrt{\alpha_t}} (x_t - \frac{\beta_t}{\sqrt{1 - \bar{\alpha_t}}} \epsilon_{\theta}(x_t, t)),
\end{equation}
</code></pre>
<p>meaning we instead learn the estimator of the <strong>noise</strong> in the mean term at step $t$: $\epsilon_{\theta}(x_t, t))$ from
the state $x_t$.</p>
<p>This can be further simplified by setting $t$ to be <em>continuous</em> on $[1, T]$ and optimizing the following simplified
objective for $\epsilon_\theta(x_t, t)$:</p>
<p>\begin{equation}
L_{\text{simple}}(\theta) := \mathbb{E}<em>{t, x_0, \epsilon} \left[\Vert \epsilon - \epsilon</em>\theta(\sqrt{\bar{\alpha}_t} x_0 + \sqrt{1 - \bar{\alpha}<em>t} \epsilon, t) \Vert^2\right]
\end{equation} This can be optimized using standard optimization techniques, such as gradient descent. We can now state
the two algorithms needed to first, train the noise estimator $\epsilon</em>\theta$, and then, obtain a sample from the
reverse diffusion process: 















<figure  id="figure-the-two-algorithms-due-to-ho-et-al">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="Algorithms due to Ho et
al." srcset="
               /post/gflownet/ho_algos_hu770e42ced4accfc410685173b9a7f10b_46392_0a08489dc02e1614643328f673a49ff7.webp 400w,
               /post/gflownet/ho_algos_hu770e42ced4accfc410685173b9a7f10b_46392_e8dedaa28e2aec0216cf7ee1634863a6.webp 760w,
               /post/gflownet/ho_algos_hu770e42ced4accfc410685173b9a7f10b_46392_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/gflownet/ho_algos_hu770e42ced4accfc410685173b9a7f10b_46392_0a08489dc02e1614643328f673a49ff7.webp"
               width="760"
               height="200"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      The two algorithms due to Ho et al.
    </figcaption></figure>
{width=&ldquo;75%&quot;}</p>
<h3 id="architecture">Architecture</h3>
<p>Ho et al. used a variation of an U-net called <a href="https://arxiv.org/abs/1701.05517" target="_blank" rel="noopener">PixelCNN++</a> to estimate
$\epsilon_{\theta}(x_t, t))$:</p>
<p>















<figure  id="figure-the-original-u-net">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="&lt;em&gt;The original U-net&lt;/em&gt;" srcset="
               /post/gflownet/u-net-architecture_hua7d70ae1f7cbdafa7d7ab33e5d6fa6be_103270_dd09f8875154f6313af3845de56e74a7.webp 400w,
               /post/gflownet/u-net-architecture_hua7d70ae1f7cbdafa7d7ab33e5d6fa6be_103270_1b262ebee0452a1ad9d815a3a1bed74c.webp 760w,
               /post/gflownet/u-net-architecture_hua7d70ae1f7cbdafa7d7ab33e5d6fa6be_103270_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/gflownet/u-net-architecture_hua7d70ae1f7cbdafa7d7ab33e5d6fa6be_103270_dd09f8875154f6313af3845de56e74a7.webp"
               width="760"
               height="506"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      The original U-net
    </figcaption></figure>
{width=&ldquo;50%&quot;}</p>
<p>















<figure  id="figure-salimans-et-al---pixelcnn-structure">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="&lt;em&gt;PixelCNN&#43;&#43; structure&lt;/em&gt;" srcset="
               /post/gflownet/pixelcnn_hu1c2fdc16633231d20f9f93a131c1179b_39354_43dd05b8aa31414c4c2e9f413739d516.webp 400w,
               /post/gflownet/pixelcnn_hu1c2fdc16633231d20f9f93a131c1179b_39354_649e9ed83bf9ef10bda59c0e9357d7a5.webp 760w,
               /post/gflownet/pixelcnn_hu1c2fdc16633231d20f9f93a131c1179b_39354_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/gflownet/pixelcnn_hu1c2fdc16633231d20f9f93a131c1179b_39354_43dd05b8aa31414c4c2e9f413739d516.webp"
               width="760"
               height="230"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Salimans et al. - PixelCNN++ structure
    </figcaption></figure>
{width=&ldquo;125%&quot;}</p>
<h2 id="how-does-it-work-in-practice">How does it work in practice?</h2>
<h3 id="example---recovery">Example - recovery</h3>
<p>















<figure  id="figure-spiral-distribution-recovery">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="&lt;em&gt;Recovery (middle row) of a spiral distribution (top) using a Gaussian diffusion model. The bottom row represents the
&amp;ldquo;drift term&amp;rdquo;, i.e. the field controlling the mean for the &amp;ldquo;particles&amp;rdquo; in the next step of the reverse
process.&lt;/em&gt;" srcset="
               /post/gflownet/sohl-dickstein_spiral_hu6033b7fe1d3f0a2b0d916b204e6c78b7_432518_26d30076e346b31c0c22f4502cdcd293.webp 400w,
               /post/gflownet/sohl-dickstein_spiral_hu6033b7fe1d3f0a2b0d916b204e6c78b7_432518_8ff010c840b50aeafd041629df4ca241.webp 760w,
               /post/gflownet/sohl-dickstein_spiral_hu6033b7fe1d3f0a2b0d916b204e6c78b7_432518_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/gflownet/sohl-dickstein_spiral_hu6033b7fe1d3f0a2b0d916b204e6c78b7_432518_26d30076e346b31c0c22f4502cdcd293.webp"
               width="760"
               height="540"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Spiral distribution recovery
    </figcaption></figure>
{width=&ldquo;80%&quot;}</p>
<h3 id="example---generation">Example - generation</h3>
<p>Ho et al. used the modified network for both <strong>conditional</strong> and <strong>unconditional</strong> generation.</p>
<p>The <em>unconditional generation</em> was performed by estimating $x_0$ - the end result of the reverse process - from
initially random $x_T$. The following figure shows the order in which features crystallize when the <em>initial state is
itself sampled from various points of the reverse process</em>. The training dataset was CIFAR10.</p>
<p>















<figure  id="figure-unconditional-generation-from-the-reverse-process-sample">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="&lt;em&gt;Unconditional generation from the reverse process
sample&lt;/em&gt;" srcset="
               /post/gflownet/ho_uncgen_hu596246d6f83e271abee3f92340d7e1f4_200694_37bdd76bb4e858cea3801f54b137caa3.webp 400w,
               /post/gflownet/ho_uncgen_hu596246d6f83e271abee3f92340d7e1f4_200694_7a9e16e211ea18623737c1bd2945437c.webp 760w,
               /post/gflownet/ho_uncgen_hu596246d6f83e271abee3f92340d7e1f4_200694_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/gflownet/ho_uncgen_hu596246d6f83e271abee3f92340d7e1f4_200694_37bdd76bb4e858cea3801f54b137caa3.webp"
               width="760"
               height="172"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Unconditional generation from the reverse process sample
    </figcaption></figure>
{width=&ldquo;1500&rdquo;}</p>
<p>For <em>conditional generation,</em> the authors selected a $x_t$ from the actual distribution and sampled from the predictive
posterior $p(x_0|x_t)$. The following figure shows the results conditioned on the bottom-right quadrant, for a network
trained on CelebA-HQ:</p>
<p>















<figure  id="figure-conditional-generation-samples-from-a-given-state">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="&lt;em&gt;Conditional generation samples from a given state:&lt;/em&gt; the earlier the $x_t$, the more deterministic the
outcome." srcset="
               /post/gflownet/ho_condgen_hu79304fa7f9aa27b6a5838733cd076033_204919_4dd7102f28081137139b56b59f89146c.webp 400w,
               /post/gflownet/ho_condgen_hu79304fa7f9aa27b6a5838733cd076033_204919_282e9ba0da2acc4ea038e4097bd65d71.webp 760w,
               /post/gflownet/ho_condgen_hu79304fa7f9aa27b6a5838733cd076033_204919_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/gflownet/ho_condgen_hu79304fa7f9aa27b6a5838733cd076033_204919_4dd7102f28081137139b56b59f89146c.webp"
               width="760"
               height="180"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      Conditional generation samples from a given state
    </figcaption></figure>
{width=&ldquo;1500&rdquo;}</p>
<h3 id="imagen--dall-e-2">Imagen &amp; DALL-E 2</h3>
<p><a href="https://arxiv.org/abs/2207.12598" target="_blank" rel="noopener">Ho and Salimans</a> improved the above procedure by introducing the notion of <em>guiding</em>
the model during training on labeled data, i.e. estimating $\epsilon_\theta(x_t, t ∣ y)$, where $y$ are the labels. The
crux of the approach is training both on conditional and unconditional objectives at once by randomly setting the class
label to a null class with some predetermined probability. Likewise, the samples are drawn from a convex combination
(with the same coefficient) of both $p$-s.</p>
<p>This was used by Nichol et al. in <a href="https://arxiv.org/abs/2112.10741?s=09" target="_blank" rel="noopener">GLIDE</a>, which uses information extracted from
text to do the guiding, combining a transformer with the previously described architecture.</p>
<p>This approach has been used to construct <a href="https://arxiv.org/pdf/2205.11487.pdf" target="_blank" rel="noopener">Imagen</a>, which uses additional diffusion
models to up-sample the image created by the guided diffusion process. The text embeddings are provided by a
<em>pretrained</em> transformer&rsquo;s encoder.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="&lt;em&gt;Imagen structure&lt;/em&gt;" srcset="
               /post/gflownet/imagen_hu3ac25849951c4040bfb452f83013f992_196848_f109af4293119160f9fe732b9554635a.webp 400w,
               /post/gflownet/imagen_hu3ac25849951c4040bfb452f83013f992_196848_38274f7b68e386255b7b64c026fe5a3b.webp 760w,
               /post/gflownet/imagen_hu3ac25849951c4040bfb452f83013f992_196848_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/gflownet/imagen_hu3ac25849951c4040bfb452f83013f992_196848_f109af4293119160f9fe732b9554635a.webp"
               width="635"
               height="644"
               loading="lazy" data-zoomable /></div>
  </div></figure>
{width=&ldquo;700&rdquo;}</p>
<p>The other diffusion-based model to make waves recently - DALL-E 2 - uses a bit more complex approach:</p>
<p>















<figure  id="figure-dall-e-2-architecture">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="&lt;em&gt;DALL-E 2 architecture&lt;/em&gt;" srcset="
               /post/gflownet/dalle2_hua1659d01b788753569c0f068636fac52_128584_e2d959c532ec2831c6a44e67562fd6e1.webp 400w,
               /post/gflownet/dalle2_hua1659d01b788753569c0f068636fac52_128584_4ed7ea5fb56b9c9ff16a24e1e0414982.webp 760w,
               /post/gflownet/dalle2_hua1659d01b788753569c0f068636fac52_128584_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/gflownet/dalle2_hua1659d01b788753569c0f068636fac52_128584_e2d959c532ec2831c6a44e67562fd6e1.webp"
               width="760"
               height="315"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      DALL-E 2 architecture
    </figcaption></figure>
</p>
<p>First, it re-uses a model called CLIP (Contrastive Language-Image Pre-training) to construct a <em>mapping between captions
and images</em> (top of the schematic above). In practice, the net result of this is a <em>joint embedding of text and images</em>
in a representation space.</p>
<p>In generation, this model is frozen and a version of the GLIDE guided diffusion model is used to generate images
<strong>starting from the image representation space</strong> (as opposed to random noise, for instance). As previously, additional
up-samplers are used in the decoder, as well.</p>
<p>To generate from text prompts, we need to map the caption text embeddings to the above mentioned image embeddings, which
are the starting point for the decoder. This is done with an <em>additional diffusion model</em> called <strong>the prior</strong>, which
generates <em>multiple possible embeddings.</em> In other words, this is a generative model of the image embeddings given the
text embeddings. The prior trains a decoder-only transformer to predict the conditional reverse process, as opposed to
the U-net used in other examples.</p>
<p>















<figure  id="figure-dall-e-2-interpolation-of-the-image-embedding-space">
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="&lt;em&gt;DALL-E 2: interpolation of the image embedding space by the
decoder&lt;/em&gt;" srcset="
               /post/gflownet/dalle2_interpolation_hu2548f22b72f3b69286d51c0a8d133041_592271_1244e345feb440c79071c31a06d11c94.webp 400w,
               /post/gflownet/dalle2_interpolation_hu2548f22b72f3b69286d51c0a8d133041_592271_ce04e60fc8e3754a06ad3b16639473d6.webp 760w,
               /post/gflownet/dalle2_interpolation_hu2548f22b72f3b69286d51c0a8d133041_592271_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/gflownet/dalle2_interpolation_hu2548f22b72f3b69286d51c0a8d133041_592271_1244e345feb440c79071c31a06d11c94.webp"
               width="760"
               height="259"
               loading="lazy" data-zoomable /></div>
  </div><figcaption>
      DALL-E 2: interpolation of the image embedding space
    </figcaption></figure>
</p>
<h2 id="references">References</h2>

    </div>

    






<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/deep-learning/">Deep Learning</a>
  
  <a class="badge badge-light" href="/tag/statistics/">Statistics</a>
  
  <a class="badge badge-light" href="/tag/generative-models/">Generative models</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://andleb.netlify.app/post/gflownet/&amp;text=Generative%20Flow%20Networks" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://andleb.netlify.app/post/gflownet/&amp;t=Generative%20Flow%20Networks" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Generative%20Flow%20Networks&amp;body=https://andleb.netlify.app/post/gflownet/" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://andleb.netlify.app/post/gflownet/&amp;title=Generative%20Flow%20Networks" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://andleb.netlify.app/"></a></h5>
      
      
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:leban@umich.edu" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/" >
        <i class="fas fa-"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/andleb" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/anleb1" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.com/citations?user=dHJ98jAAAAAJ&amp;hl=en" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>
















  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/post/presentation-of-our-work-on-whale-communication-at-the-simons-institute/">A talk on our work on whale communication at the Simons Institute</a></li>
      
      <li><a href="/post/new-publication-approaching-an-unknown-communication-system/">New publication: Approaching an unknown communication system</a></li>
      
      <li><a href="/post/diffusion-models/">Diffusion models: an introduction</a></li>
      
      <li><a href="/post/new-publication-projects/">New publication, projects</a></li>
      
      <li><a href="/project/ganising/">ganIsing</a></li>
      
    </ul>
  </div>
  





  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  



  

  
  <p class="powered-by">
    
    
      
      <a href="/terms/">License</a>
    
  </p>
  

  

  
  






  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a> — the free, <a href="https://github.com/wowchemy/wowchemy-hugo-themes" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      

    
    <script src="/js/vendor-bundle.min.b73dfaac3b6499dc997741748a7c3fe2.js"></script>

    
    
    
      
      
        <script src="https://cdn.jsdelivr.net/gh/desandro/imagesloaded@v4.1.4/imagesloaded.pkgd.min.js" integrity="sha512-S5PZ9GxJZO16tT9r3WJp/Safn31eu8uWrzglMahDT4dsmgqWonRY9grk3j+3tfuPr9WJNsfooOR7Gi7HL5W2jw==" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/gh/metafizzy/isotope@v3.0.6/dist/isotope.pkgd.min.js" integrity="sha512-Zq2BOxyhvnRFXu0+WE6ojpZLOU2jdnqbrM1hmVdGzyeCa1DgM3X5Q4A/Is9xA1IkbUeDd7755dNNI/PzSf2Pew==" crossorigin="anonymous"></script>
      

      
      

      
        <script src="https://cdn.jsdelivr.net/gh/mermaid-js/mermaid@v8.8.4/dist/mermaid.min.js" integrity="sha512-+TNmhaRJf3jyYHTpzEq/5I6b+aGyhzWb21mGdHAjxSGSYwxN9Grug3Y3B9qVxWfKKY8MscE/6mr9walWvFLFvQ==" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
        
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/r.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/python.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/latex.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/cpp.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/cmake.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/bash.min.js" crossorigin="anonymous"></script>
        
      

    

    
    
    
      <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js" integrity="" crossorigin="anonymous"></script>
    

    
    

    
    
    
      
      <script id="search-hit-fuse-template" type="text/x-template">
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script>
      
        <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
      
    

    
    

    
    
    
    

    
    
      
      
      
      
      
      
      
    

    

    
    
    
    <script id="page-data" type="application/json">{"use_headroom":true}</script>

    
    
      <script src="/js/wowchemy-headroom.1cb9e2fc8399acee94eab837265b73bf.js" type="module"></script>
    
    
    
    
    
    
    
      
      
    
    
    <script src="/en/js/wowchemy.min.247fd8f54253895301106e3006f53f38.js"></script>

    
  <script async defer src="https://buttons.github.io/buttons.js"></script>




</body>
</html>
